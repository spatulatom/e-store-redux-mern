{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import socketIOClient from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ENDPOINT=window.location.host.indexOf('localhost')>=0?'http://127.0.0.1:5000':window.location.host;export default function ChatBox(props){const{userInfo}=props;const[socket,setSocket]=useState(null);const uiMessagesRef=useRef(null);const[isOpen,setIsOpen]=useState(false);const[messageBody,setMessageBody]=useState('');const[messages,setMessages]=useState([{name:'Admin',body:'Hello there, Please ask your question.'}]);useEffect(()=>{if(uiMessagesRef.current){uiMessagesRef.current.scrollBy({top:uiMessagesRef.current.clientHeight,left:0,behavior:'smooth'});}if(socket){socket.emit('onLogin',{_id:userInfo._id,name:userInfo.name,isAdmin:userInfo.isAdmin});socket.on('message',data=>{setMessages([...messages,{body:data.body,name:data.name}]);});}},[messages,isOpen,socket,userInfo]);const supportHandler=()=>{setIsOpen(true);console.log(ENDPOINT);const sk=socketIOClient(ENDPOINT);setSocket(sk);};const submitHandler=e=>{e.preventDefault();if(!messageBody.trim()){alert('Error. Please type message.');}else{setMessages([...messages,{body:messageBody,name:userInfo.name}]);setMessageBody('');setTimeout(()=>{socket.emit('onMessage',{body:messageBody,name:userInfo.name,isAdmin:userInfo.isAdmin,_id:userInfo._id});},1000);}};const closeHandler=()=>{setIsOpen(false);};return/*#__PURE__*/_jsx(\"div\",{className:\"chatbox\",children:!isOpen?/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:supportHandler,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-support\"})}):/*#__PURE__*/_jsxs(\"div\",{className:\"card card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Support \"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:closeHandler,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-close\"})})]}),/*#__PURE__*/_jsx(\"ul\",{ref:uiMessagesRef,children:messages.map((msg,index)=>/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\".concat(msg.name,\": \")}),\" \",msg.body]},index))}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,className:\"row\",children:[/*#__PURE__*/_jsx(\"input\",{value:messageBody,onChange:e=>setMessageBody(e.target.value),type:\"text\",placeholder:\"type message\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Send\"})]})})]})});}","map":{"version":3,"names":["React","useEffect","useRef","useState","socketIOClient","jsx","_jsx","jsxs","_jsxs","ENDPOINT","window","location","host","indexOf","ChatBox","props","userInfo","socket","setSocket","uiMessagesRef","isOpen","setIsOpen","messageBody","setMessageBody","messages","setMessages","name","body","current","scrollBy","top","clientHeight","left","behavior","emit","_id","isAdmin","on","data","supportHandler","console","log","sk","submitHandler","e","preventDefault","trim","alert","setTimeout","closeHandler","className","children","type","onClick","ref","map","msg","index","concat","onSubmit","value","onChange","target","placeholder"],"sources":["D:/projects/e-store-redux-mern/frontend/src/components/ChatBox.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport socketIOClient from 'socket.io-client';\r\n\r\nconst ENDPOINT =\r\n  window.location.host.indexOf('localhost') >= 0\r\n    ? 'http://127.0.0.1:5000'\r\n    : window.location.host;\r\n\r\nexport default function ChatBox(props) {\r\n  const { userInfo } = props;\r\n  const [socket, setSocket] = useState(null);\r\n  const uiMessagesRef = useRef(null);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [messageBody, setMessageBody] = useState('');\r\n  const [messages, setMessages] = useState([\r\n    { name: 'Admin', body: 'Hello there, Please ask your question.' },\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (uiMessagesRef.current) {\r\n      uiMessagesRef.current.scrollBy({\r\n        top: uiMessagesRef.current.clientHeight,\r\n        left: 0,\r\n        behavior: 'smooth',\r\n      });\r\n    }\r\n    if (socket) {\r\n      socket.emit('onLogin', {\r\n        _id: userInfo._id,\r\n        name: userInfo.name,\r\n        isAdmin: userInfo.isAdmin,\r\n      });\r\n      socket.on('message', (data) => {\r\n        setMessages([...messages, { body: data.body, name: data.name }]);\r\n      });\r\n    }\r\n  }, [messages, isOpen, socket, userInfo]);\r\n\r\n  const supportHandler = () => {\r\n    setIsOpen(true);\r\n    console.log(ENDPOINT);\r\n    const sk = socketIOClient(ENDPOINT);\r\n    setSocket(sk);\r\n  };\r\n  const submitHandler = (e) => {\r\n    e.preventDefault();\r\n    if (!messageBody.trim()) {\r\n      alert('Error. Please type message.');\r\n    } else {\r\n      setMessages([...messages, { body: messageBody, name: userInfo.name }]);\r\n      setMessageBody('');\r\n      setTimeout(() => {\r\n        socket.emit('onMessage', {\r\n          body: messageBody,\r\n          name: userInfo.name,\r\n          isAdmin: userInfo.isAdmin,\r\n          _id: userInfo._id,\r\n        });\r\n      }, 1000);\r\n    }\r\n  };\r\n  const closeHandler = () => {\r\n    setIsOpen(false);\r\n  };\r\n  return (\r\n    <div className=\"chatbox\">\r\n      {!isOpen ? (\r\n        <button type=\"button\" onClick={supportHandler}>\r\n          <i className=\"fa fa-support\" />\r\n        </button>\r\n      ) : (\r\n        <div className=\"card card-body\">\r\n          <div className=\"row\">\r\n            <strong>Support </strong>\r\n            <button type=\"button\" onClick={closeHandler}>\r\n              <i className=\"fa fa-close\" />\r\n            </button>\r\n          </div>\r\n          <ul ref={uiMessagesRef}>\r\n            {messages.map((msg, index) => (\r\n              <li key={index}>\r\n                <strong>{`${msg.name}: `}</strong> {msg.body}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n          <div>\r\n            <form onSubmit={submitHandler} className=\"row\">\r\n              <input\r\n                value={messageBody}\r\n                onChange={(e) => setMessageBody(e.target.value)}\r\n                type=\"text\"\r\n                placeholder=\"type message\"\r\n              />\r\n              <button type=\"submit\">Send</button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}